---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(jagsUI)
library(here)
library(furrr)
```

```{r}
original_results <- readRDS(here("bayesian_modeling", "gamma_original.rds"))
```

Mode
```{r}
# mode (calculated from samples)
mode_draws <- ((original_results$sims.list$shape_flight - 1)/original_results$sims.list$rate_flight)*2183.475

mean(mode_draws)
# 35.5557
sd(mode_draws)
# 62.18645
quantile(mode_draws, probs = c(.025, .975))
# -99.07641 145.68088 

# mode (calculated from mean shape and rate values)
# ((original_results$mean$shape_flight - 1)/original_results$mean$rate_flight)*2183.475
```

Median
```{r}
plan(multisession)

median_draws <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              return(median(res))
            })

plan(sequential)

median_draws %>% 
  unlist() %>% 
  mean() #262.3743

# median_draws %>% 
#   unlist() %>% 
#   sd() #34.59358

median_draws %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) #

median_draws %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #194.8041 331.5516
```

Mean
```{r}
plan(multisession)

mean_draws <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              return(mean(res))
            })

plan(sequential)

mean_draws %>% 
  unlist() %>% 
  mean() #363.7003

# mean_draws %>% 
#   unlist() %>% 
#   sd() #33.79488

mean_draws %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) #

mean_draws %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #299.7807 431.6174 
```

Are these birds regularly flying lower than the flight heights reported via radar?
Calculate the percentage of these locations that fall below the minimum	threshold in Horton et al. 2016 (155m)
```{r}
plan(multisession)

pct_below_radar_threshold <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              return(sum(res < 155)/10000)
            })

plan(sequential)

pct_below_radar_threshold %>% 
  unlist() %>% 
  mean() #0.325808

# pct_below_radar_threshold %>% 
#   unlist() %>% 
#   sd() #0.05297934

pct_below_radar_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) #

pct_below_radar_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #0.2251 0.4337
```

How may of these locations are at an altitude where they might collide with a building (0-47m)?
```{r}
plan(multisession)

pct_below_building_threshold <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              derived <- sum(res <= 47)/10000
              
              return(derived)
            })

plan(sequential)

pct_below_building_threshold %>% 
  unlist() %>% 
  mean() #0.1046778

# pct_below_building_threshold %>% 
#   unlist() %>% 
#   sd() #0.03712942

pct_below_building_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) # 

pct_below_building_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #0.0445 0.1897 
```

How may of these locations are at an altitude where they might collide with a comm tower (0-244m)?
```{r}
plan(multisession)

pct_below_comm_tower_threshold <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              derived <- sum(res <= 244)/10000
              
              return(derived)
            })

plan(sequential)

pct_below_comm_tower_threshold %>% 
  unlist() %>% 
  mean() #0.4733745

# pct_below_comm_tower_threshold %>% 
#   unlist() %>% 
#   sd() #0.05003813

pct_below_comm_tower_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) #

pct_below_comm_tower_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #0.3744 0.5711 
```

How may of these locations are at an altitude where they might collide with a wind turbine (32.2-163.8m)?
```{r}
plan(multisession)

pct_below_wind_threshold <- future_map2(.x = original_results$sims.list$shape_flight, 
            .y = original_results$sims.list$rate_flight,
            .progress = TRUE,
            .options = furrr_options(seed = 8),
            .f = function(x, y){
              res <- rgamma(n = 10000, 
                          shape = x,
                          rate = y)
              
              res <- res * 2183.475
              
              derived <- sum(res > 32.2 & res <= 163.8)/10000
              
              return(derived)
            })

plan(sequential)

pct_below_wind_threshold %>% 
  unlist() %>% 
  mean() #0.2702086

# pct_below_wind_threshold %>% 
#   unlist() %>% 
#   sd() #0.02655657

pct_below_wind_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.25, .75)) #

pct_below_wind_threshold %>% 
  unlist() %>% 
  quantile(probs = c(.025, .975)) #0.2129 0.3174
```