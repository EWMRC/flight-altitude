st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(height_above_wgs84 = height_abo,
height_above_geoid = POINT_Z,
height_above_terrain = alt_trrn,
ID = local_id)
prior_alt_locations <- read.csv("altitude_locs_3D.csv")
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
altitude_locations$time <- altitude_locations$time %>% ymd_hms()
altitude_locations$time %>% class()
altitude_locations$X <- NULL
altitude_locations %>% filter(MeanElevat == 0) %<% nrow()
altitude_locations %>% filter(MeanElevat == 0) %>% nrow()
altitude_locations <- st_read("altitude_locs_3D_navd88_w_terrain.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(height_above_wgs84 = height_abo,
height_above_geoid = POINT_Z,
height_above_terrain = alt_trrn,
ID = local_id)
altitude_locations %>% filter(MeanElevat == 0) %>% nrow()
altitude_locations %>% filter(MeanElevat == 0) -> altitude_locations
class(altitude_locations)
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = long) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations <- st_read("altitude_locs_3D_navd88_w_terrain.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(height_above_wgs84 = height_abo,
height_above_geoid = POINT_Z,
height_above_terrain = alt_trrn,
ID = local_id)
prior_alt_locations <- read.csv("altitude_locs_3D.csv")
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
altitude_locations$time <- altitude_locations$time %>% ymd_hms()
altitude_locations$X <- NULL
altitude_locations %>% filter(MeanElevat == 0) -> altitude_locations
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = long) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunset) ->
altitude_locations$sunset
altitude_locations %>%
mutate(day_night = if_else(timestamp > sunrise & timestamp < sunset, "Day", "Night")) ->
altitude_locations
altitude_locations %>%
mutate(day_night = if_else(time > sunrise & time < sunset, "Day", "Night")) ->
altitude_locations
flight_locations %>%
filter(day_night == "Day") %>%
ggplot(aes(y = height_above_terrain)) +
geom_boxplot()
altitude_locations %>%
filter(day_night == "Day") %>%
ggplot(aes(y = height_above_terrain)) +
geom_boxplot()
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = height_above_terrain)) +
geom_boxplot()
altitude_locations %>% filter(is.na(day_night)) %>% nrow()
altitude_locations %>% filter(is.na(day_night)) %>% View()
altitude_locations <- st_read("altitude_locs_3D_navd88_w_terrain.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(height_above_wgs84 = height_abo,
height_above_geoid = POINT_Z,
height_above_terrain = alt_trrn,
ID = local_id)
prior_alt_locations <- read.csv("altitude_locs_3D.csv")
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
altitude_locations$time <- altitude_locations$time %>% ymd_hms()
altitude_locations$X <- NULL
altitude_locations %>% filter(MeanElevat == 0) -> altitude_locations
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunset) ->
altitude_locations$sunset
altitude_locations %>%
mutate(day_night = if_else(time > sunrise & time < sunset, "Day", "Night")) ->
altitude_locations
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = height_above_terrain)) +
geom_boxplot()
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = height_above_terrain)) +
geom_boxplot() +
EnvStats::stat_n_text()
citation("landscapemetrics")
library(tidyverse)
library(sf)
library(lubridate)
library(move)
library(there)
login <- movebankLogin(username = "acfish", password="EPvzvNSUJ8")
amwo_data <- getMovebankData(study = "American Woodcock Migration Ecology in Eastern North America",
login = login,
removeDuplicatedTimestamps=TRUE)
amwo_data <- as.data.frame(amwo_data)
amwo_data %>%
transmute(ID = local_identifier,
time = as.character(timestamp),
lon = location_long,
lat = location_lat,
tagtype = comments,
sex = sex,
age = taxon_detail,
height_above_wgs84 = height_above_msl) ->
amwo_data
View(amwo_data)
amwo_data <- getMovebankData(study = "American Woodcock Migration Ecology in Eastern North America",
login = login,
removeDuplicatedTimestamps=TRUE)
amwo_data <- as.data.frame(amwo_data)
amwo_data %>%
transmute(ID = local_identifier,
time = as.character(timestamp),
lon = location_long,
lat = location_lat,
tagtype = comments,
sex = sex,
age = taxon_detail,
height_above_wgs84 = height_above_msl,
fix = location_error_text) ->
amwo_data
amwo_data %>%
filter(!is.na(height_above_wgs84)) %>%
write.csv("altitude_locs_3D.csv")
library(tidyverse)
library(lubridate)
library(sf)
library(mapview)
library(suncalc)
library(googledrive)
library(there)
library(colorspace)
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(ID = local_id)
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL)
View(altitude_locations)
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL) %>%
rename(terrain_height = RASTERVALU)
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL,
POINT_x = NULL,
POINT_Y = NULL,
POINT_Z = NULL,
POINT_M = NULL,
Field1 = NULL) %>%
rename(terrain_height = RASTERVALU,
height_above_ellipsoid = height_abo)
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL,
POINT_X = NULL,
POINT_Y = NULL,
POINT_Z = NULL,
POINT_M = NULL,
Field1 = NULL) %>%
rename(terrain_height = RASTERVALU,
height_above_ellipsoid = height_abo)
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
prior_alt_locations <- read.csv("altitude_locs_3D.csv")
View(prior_alt_locations)
prior_alt_locations <- read.csv("altitude_locs_3D.csv") %>%
dplyr::select(ID, time, lon, lat)
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
altitude_locations$time <- altitude_locations$time %>% ymd_hms()
altitude_locations %>% filter(is.na(alt_hat)) %>% nrow()
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunset) ->
altitude_locations$sunset
altitude_locations %>%
mutate(day_night = if_else(time > sunrise & time < sunset, "Day", "Night")) ->
altitude_locations
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = height_above_terrain)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations %>%
filter(is.na(day_night)) %>%
View()
altitude_locations %>%
filter(day_night == "Day") %>%
ggplot(aes(x = fix, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations %>%
filter(fix = "3D") ->
altitude_locations_3D
altitude_locations %>%
filter(fix == "3D") ->
altitude_locations_3D
altitude_locations %>%
filter(day_night == "Day") %>%
ggplot(aes(x = fix, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations_3D %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations_3D %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text() +
theme_bw()
quantile(duration, c(.95))
altitude_locations_3D %>%
filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text() +
theme_bw()
altitude_locations_3D %>%
filter() %>%
pull(alt_hat) %>%
quantile(c(.95))
altitude_locations_3D %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text() +
theme_bw()
altitude_locations_3D %>%
filter(day_night == "Day") %>%
pull(alt_hat) %>%
quantile(c(.95))
altitude_locations_3D %>%
filter(day_night == "Day") %>%
pull(alt_hat) %>%
quantile(c(.95))
altitude_locations_3D %>%
filter(day_night == "Night") %>%
pull(alt_hat) %>%
quantile(c(.95))
altitude_locations_3D %>%
filter(day_night == "Day") %>%
pull(alt_hat) %>%
quantile(c(.95))
altitude_locations_3D %>%
filter(day_night == "Day") %>%
pull(alt_hat) %>%
quantile(c(.99))
0.01*3325
night_flight_locations <- altitude_locations_3D %>%
filter(day_night == "Night") %>%
rename(`Movebank ID` = ID)
View(night_flight_locations)
night_flight_locations <- altitude_locations_3D %>%
filter(day_night == "Night") %>%
rename(`Movebank ID` = ID) %>%
filter(alt_hat > 115.3186)
View(night_flight_locations)
as_id("https://drive.google.com/file/d/19JA5OztH3hS4MPfVnH5zswDxSSLcWxL3/view?usp=sharing") %>%
drive_download(path = here_file("Data", "Google_drive_downloads","capture_sheet.xlsx"), overwrite = TRUE)
capture_sheet <- readxl::read_excel(here_file("Data", "Google_drive_downloads","capture_sheet.xlsx"), col_types = c("text", "text", "date", "numeric", "numeric", "numeric", "numeric", "text", "text", "text", "text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "text", "text", "text", "text")) %>%
mutate(`Argos ID` = as.character(`Argos ID`))
capture_sheet %>%
dplyr::select(`Movebank ID`, Sex, Age) %>%
right_join(night_flight_locations) ->
night_flight_locations
night_flight_locations$`Movebank ID` %>% unique() %>% length()
#locations broken out by age and sex
night_flight_locations %>%
group_by(Sex, Age) %>%
tally() %>%
View()
#individuals broken out by age and sex
night_flight_locations %>%
dplyr::select(`Movebank ID`, Sex, Age) %>%
distinct() %>%
group_by(Sex, Age) %>%
tally() %>%
View()
night_flight_locations %>%
mutate(month_day = as.numeric(paste0(month(time), "." , day(time)))) %>%
mutate(season = ifelse(month_day > 9 | month_day < 2, "Fall", "Breeding")) %>%
mutate(season = ifelse(month_day > 2 & month_day < 6, "Spring", season)) ->
night_flight_locations
#locations broken out by age and sex
night_flight_locations %>%
#filter(season == "Spring") %>%
group_by(Sex, Age, season) %>%
tally() %>%
View()
#individuals broken out by age and sex
night_flight_locations %>%
#filter(season == "Spring") %>%
dplyr::select(`Movebank ID`, Sex, Age, season) %>%
distinct() %>%
group_by(Sex, Age) %>%
tally() %>%
View()
night_flight_locations %>%
filter(season != "Breeding") %>%
ggplot(aes(x = season, y = altitude)) +
geom_boxplot() +
theme_bw() +
xlab("Season") +
ylab("Altitude (m)") +
EnvStats::stat_n_text()
night_flight_locations %>%
filter(season != "Breeding") %>%
ggplot(aes(x = season, y = alt_hat)) +
geom_boxplot() +
theme_bw() +
xlab("Season") +
ylab("Altitude (m)") +
EnvStats::stat_n_text()
ggsave("altitude_by_season_revised.png", width = 6, height = 5)
st_write(night_flight_locations, "night_flight_locations_9_6_21.shp")
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally() %>%
ggplot(aes(x = Sex, fill = Age, y = n)) +
geom_bar(position = "dodge", color = "black", stat = "identity") +
theme_bw() +
facet_wrap(vars(season)) +
ylab("Number of locations") +
scale_fill_manual(values = diverge_hcl(2, c = 130))
ggsave("num_locs_age_sex_season_revised.png", width = 7, height = 5)
library(tidyverse)
library(lubridate)
library(sf)
library(mapview)
library(suncalc)
library(googledrive)
library(there)
library(colorspace)
#individuals broken out by age and sex
night_flight_locations %>%
dplyr::select(`Movebank ID`, Sex, Age) %>%
distinct() %>%
group_by(Sex, Age) %>%
tally() %>%
View()
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally() %>%
ggplot(aes(x = Sex, fill = Age, y = n)) +
geom_bar(position = "dodge", color = "black", stat = "identity") +
theme_bw() +
facet_wrap(vars(season)) +
ylab("Number of locations") +
scale_fill_manual(values = diverge_hcl(2, c = 130))
library(tidyverse)
library(lubridate)
library(sf)
library(mapview)
library(suncalc)
library(googledrive)
library(there)
library(colorspace)
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally() %>%
ggplot(aes(x = Sex, fill = Age, y = n)) +
geom_bar(position = "dodge", color = "black", stat = "identity") +
theme_bw() +
facet_wrap(vars(season)) +
ylab("Number of locations") +
scale_fill_manual(values = diverge_hcl(2, c = 130))
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally()
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally() %>%
mutate(season = recode(season, "Breeding" = "Summer"))
night_flight_locations %>%
mutate(Age = recode(Age, "AHY" = "Adult", "ASY" = "Adult", "HY" = "Young", "SY" = "Young")) %>%
group_by(Sex, Age, season) %>%
tally() %>%
mutate(season = recode(season, "Breeding" = "Summer")) %>%
ggplot(aes(x = Sex, fill = Age, y = n)) +
geom_bar(position = "dodge", color = "black", stat = "identity") +
theme_bw() +
facet_wrap(vars(season)) +
ylab("Number of locations") +
scale_fill_manual(values = diverge_hcl(2, c = 130))
ggsave("num_locs_age_sex_season_revised.png", width = 7, height = 5)
library(tidyverse)
library(lubridate)
library(sf)
library(mapview)
library(suncalc)
library(googledrive)
library(there)
library(colorspace)
install.packages("remotes")
remotes::install_github("LiamABerigan/there")
altitude_locations <- st_read("altitude_locs_3D_geoid_terrain_height.shp") %>%
st_drop_geometry() %>%
mutate(time = NULL,
POINT_X = NULL,
POINT_Y = NULL,
POINT_Z = NULL,
POINT_M = NULL,
Field1 = NULL) %>%
rename(terrain_height = RASTERVALU,
height_above_ellipsoid = height_abo)
prior_alt_locations <- read.csv("altitude_locs_3D.csv") %>%
dplyr::select(ID, time, lon, lat)
altitude_locations <- altitude_locations %>%
left_join(prior_alt_locations)
altitude_locations$time <- altitude_locations$time %>% ymd_hms()
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunrise) ->
altitude_locations$sunrise
altitude_locations %>%
dplyr::transmute(date = as.Date(time), lat = lat, lon = lon) %>%
getSunlightTimes(data = .) %>%
pull(sunset) ->
altitude_locations$sunset
altitude_locations %>%
mutate(day_night = if_else(time > sunrise & time < sunset, "Day", "Night")) ->
altitude_locations
altitude_locations %>%
#filter(day_night == "Day") %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations %>%
filter(day_night == "Day") %>%
ggplot(aes(x = fix, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text()
altitude_locations %>%
filter(fix == "3D") ->
altitude_locations_3D
altitude_locations_3D %>%
ggplot(aes(x = day_night, y = alt_hat)) +
geom_boxplot() +
EnvStats::stat_n_text() +
theme_bw()
altitude_locations_3D %>%
filter(day_night == "Day") %>%
pull(alt_hat) %>%
quantile(c(.99))
#Calling anything at night that is higher than 115.3186 m a flight location
night_flight_locations <- altitude_locations_3D %>%
filter(day_night == "Night") %>%
rename(`Movebank ID` = ID) %>%
filter(alt_hat > 115.3186)
as_id("https://drive.google.com/file/d/19JA5OztH3hS4MPfVnH5zswDxSSLcWxL3/view?usp=sharing") %>%
drive_download(path = here_file("Data", "Google_drive_downloads","capture_sheet.xlsx"), overwrite = TRUE)
library(there)
night_flight_locations <- altitude_locations_3D %>%
filter(day_night == "Night") %>%
rename(`Movebank ID` = ID) %>%
filter(alt_hat > 115.3186)
as_id("https://drive.google.com/file/d/19JA5OztH3hS4MPfVnH5zswDxSSLcWxL3/view?usp=sharing") %>%
drive_download(path = here_file("Data", "Google_drive_downloads","capture_sheet.xlsx"), overwrite = TRUE)
View(night_flight_locations)
write.csv(night_flight_locations, file = "night_flight_locations_9_6_2021.csv")
write.csv(night_flight_locations, file = "night_flight_locations_9_6_2021.csv", row.names = FALSE)
install.packages("move")
library(rjags)
citation("rjags")
